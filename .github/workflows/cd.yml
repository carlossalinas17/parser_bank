# =============================================================================
# CD â€” Entrega Continua
#
# Se ejecuta automÃ¡ticamente cuando se crea un tag con formato v* (ej: v0.1.0).
#
# Pasos:
#   1. Ejecuta los tests completos (por seguridad, aunque CI ya pasÃ³).
#   2. Construye el paquete Python (.whl + .tar.gz).
#   3. Crea un GitHub Release con los artefactos.
#
# Â¿CÃ³mo hacer un release?
#   git tag v0.1.0
#   git push origin v0.1.0
# =============================================================================

name: CD

on:
  push:
    tags:
      - "v*"

permissions:
  contents: write  # Necesario para crear GitHub Releases

jobs:
  release:
    name: "ðŸ“¦ Build & Release"
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Instalar proyecto y dependencias
        run: pip install -e ".[dev]"

      - name: Ejecutar tests completos
        run: pytest tests/ -v -m "not integration"

      - name: Construir paquete
        run: |
          pip install build
          python -m build

      - name: Crear GitHub Release
        uses: softprops/action-gh-release@v2
        with:
          files: dist/*
          generate_release_notes: true
